# Habilitar rewrite engine
RewriteEngine On

# Establecer la ruta base según la ubicación del proyecto
RewriteBase /crm-project/public/

# Prevenir acceso a archivos sensibles
<Files ~ "^\.">
    Order allow,deny
    Deny from all
</Files>

# Denegar acceso a archivos críticos
<FilesMatch "(\.(bak|config|dist|fla|inc|ini|log|psd|sh|sql|swp)|~)$">
    Order allow,deny
    Deny from all
    Satisfy All
</FilesMatch>

# Proteger archivos .htaccess y .htpasswd
<FilesMatch "^\.ht">
    Require all denied
</FilesMatch>

# Reglas para URLs amigables - preservando el sistema de módulos y acciones
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([a-z]+)/([a-z_]+)/?$ index.php?module=$1&action=$2 [L,QSA]

# Redirección para la página principal
RewriteRule ^$ index.php [L]

# Compresión para mejorar el rendimiento
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Configuraciones de caché para optimización
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/x-javascript "access plus 1 month"
    ExpiresByType application/x-shockwave-flash "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 year"
    ExpiresDefault "access plus 2 days"
</IfModule>

# Prevenir hotlinking de imágenes
<IfModule mod_rewrite.c>
    RewriteCond %{HTTP_REFERER} !^$
    RewriteCond %{HTTP_REFERER} !^http(s)?://(www\.)?tudominio.com [NC]
    RewriteRule \.(jpg|jpeg|png|gif)$ - [NC,F,L]
</IfModule>

# Forzar HTTPS si está disponible
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Establecer zona horaria si es necesario
# SetEnv TZ America/Mexico_City

# Prevenir que se listen los directorios
Options -Indexes

# Configuraciones de seguridad adicionales
<IfModule mod_headers.c>
    # Prevenir clickjacking
    Header always append X-Frame-Options SAMEORIGIN
    
    # Prevenir XSS
    Header set X-XSS-Protection "1; mode=block"
    
    # Prevenir MIME sniffing
    Header set X-Content-Type-Options nosniff
</IfModule>